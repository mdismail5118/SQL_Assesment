--1.Which manufacturer's planes had most no of flights? And how many flights?

SELECT MANUFACTURER, FLIGHTS_COUNT
FROM (SELECT MANUFACTURER, COUNT(FLIGHT) FLIGHTS_COUNT, DENSE_RANK() OVER (ORDER BY COUNT(FLIGHT) DESC) RNK
      FROM PLANES P INNER JOIN FLIGHTS F
      ON P.TAILNUM = F.TAILNUM
      GROUP BY MANUFACTURER)
WHERE RNK = 1;

--2.Which manufacturer's planes had most no of flying hours? And how many hours?

SELECT MANUFACTURER, TOTAL_HRS
FROM (SELECT MANUFACTURER, ROUND(HRS+MI,4) TOTAL_HRS, DENSE_RANK() OVER (ORDER BY HRS+MI DESC) RNK
      FROM (SELECT MANUFACTURER, SUM(TO_NUMBER(CASE WHEN HOUR = 'NA' THEN '0' ELSE HOUR END)) HRS,
                                 SUM(TO_NUMBER(CASE WHEN MINUTE = 'NA' THEN '0' ELSE MINUTE END)/60) MI
            FROM PLANES P INNER JOIN FLIGHTS F
            ON P.TAILNUM = F.TAILNUM
            GROUP BY MANUFACTURER))
WHERE RNK = 1;

--3.Which plane flew the most number of hours? And how many hours?

SELECT TAILNUM, TOTAL_HRS
FROM (SELECT TAILNUM, ROUND(HRS+MI,4) TOTAL_HRS, DENSE_RANK() OVER (ORDER BY HRS+MI DESC) RNK
      FROM (SELECT P.TAILNUM, SUM(TO_NUMBER(CASE WHEN HOUR = 'NA' THEN '0' ELSE HOUR END)) HRS,
                              SUM(TO_NUMBER(CASE WHEN MINUTE = 'NA' THEN '0' ELSE MINUTE END)/60) MI
            FROM PLANES P INNER JOIN FLIGHTS F
            ON P.TAILNUM = F.TAILNUM
            GROUP BY P.TAILNUM))
WHERE RNK = 1;

--4.Which destination had most delay in flights?

SELECT DEST, AIRPORT
FROM (SELECT DEST, DELAY_COUNT, DENSE_RANK() OVER (ORDER BY DELAY_COUNT DESC) RNK
      FROM (SELECT DEST,
                   COUNT(CASE WHEN TO_NUMBER(CASE WHEN ARR_DELAY = 'NA' THEN '0' ELSE HOUR END) > 0 THEN 1 END)DELAY_COUNT
            FROM FLIGHTS
            GROUP BY DEST))T1 INNER JOIN AIRPORTS A 
            ON A.IATA_CODE = T1.DEST
WHERE RNK = 1;

--5.Which manufactures planes had covered most distance? And how much distance?

SELECT MANUFACTURER, TOTAL_DISTANCE
FROM (SELECT MANUFACTURER, SUM(DISTANCE) TOTAL_DISTANCE, DENSE_RANK() OVER (ORDER BY SUM(DISTANCE) DESC) RNK
      FROM PLANES P INNER JOIN FLIGHTS F
      ON P.TAILNUM = F.TAILNUM
      GROUP BY MANUFACTURER)
WHERE RNK = 1;

--6.Which airport had most flights on weekends?

SELECT AIRPORT, FLIGHT_COUNT
FROM (SELECT ORIGIN, COUNT(FLIGHT) FLIGHT_COUNT, DENSE_RANK() OVER (ORDER BY COUNT(FLIGHT)DESC) RNK
      FROM (SELECT ORIGIN, FLIGHT, TO_CHAR(TO_DATE(TO_CHAR(YEAR||'-'||MONTH||'-'||DAY),'YYYY-MM-DD'),'DY') DAY_
            FROM FLIGHTS F)
      WHERE DAY_ IN ('SAT','SUN')
      GROUP BY ORIGIN)T1 INNER JOIN AIRPORTS A 
ON A.IATA_CODE = T1.ORIGIN
WHERE RNK = 1;